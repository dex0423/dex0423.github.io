---
layout:     post
title:      数仓：数仓中的数据分层
subtitle:   
date:       2022-01-27
author:     dex0423
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 数仓
---


# 1. 数据流向

![]({{site.baseurl}}/img-post/dw-layer-1.png)

# 2. 数仓分层的价值

数据分层的好处：

- 清晰数据结构：
  - 让每个数据层都有自己的作用和职责，在使用和维护的时候能够更方便和理解
- 复杂问题简化：
  - 将一个复杂的任务拆解成多个步骤来分步骤完成，每个层只解决特定的问题
- 统一数据口径：
  - 通过数据分层，提供统一的数据出口，统一输出口径
- 减少重复开发：
  - 规范数据分层，开发通用的中间层，可以极大地减少重复计算的工作

# 3. ODS 源数据层

##### 3.1. ODS 定义

ODS（Operation Data Store），也称为贴源层。数据源中的数据，经过抽取、洗净、传输，也就是ETL过程之后进入本层。

##### 3.2. ODS 功能

ODS 层的数据，是后续数据仓库加工数据的来源：
- ODS是后面数据仓库层的准备区
- 为DWD层提供原始数据
- 减少对业务系统的影响

>为了考虑后续可能需要追溯数据问题，因此对于这一层就不建议做过多的数据清洗工作，原封不动地接入原始数据即可。

##### 3.3. ODS 数据来源

- 业务库：
  - sqoop定时抽取数据；实时方面考虑使用canal监听mysql的binlog日志，实时接入即可

- 埋点日志：
  - 日志一般是以文件的形式保存，可以选择使用flume来定时同步；可以使用spark streaming或者Flink、Kafka来实时接入
  
- 消息队列：
  - 来自ActiveMQ、Kafka的数据等


# 4. DWD 数据细节层

##### 4.1. DWD 定义

DWD（data warehouse details），该层是业务层和数据仓库的隔离层，保持和ODS层一样的数据颗粒度。

##### 4.2. DWD 功能

主要是对ODS数据层做一些数据的清洗和规范化的操作，比如去除空数据、脏数据、离群值等。

>为了提高数据明细层的易用性，该层通常会才采用一些维度退化方法，将维度退化至事实表中，减少事实表和维表的关联。

# 5. DWM 数据中间层

##### 5.1. DWM 定义

DWM（Data Warehouse Middle），该层是在DWD层的数据基础上，对数据做一些轻微的聚合操作。

##### 5.2. DWM 功能

- DWM 通过聚合，生成一些列的中间结果表：
  - 提升公共指标的复用性，减少重复加工的工作。
  - 主要是对通用的核心维度进行聚合操作，算出相应的统计指标。

# 6. DWS 数据服务层

##### 6.1. DWS 定义

DWS（Data Warehouse Service），该层是基于DWM上的基础数据，整合汇总成分析某一个主题域的数据服务层，一般是宽表。

##### 6.2. DWS 功能

DWS 用于提供后续的业务查询，OLAP分析，数据分发等。

>一般来说，该层的数据表会相对较少；一张表会涵盖比较多的业务内容，由于其字段较多，因此一般也会称该层的表为宽表。

# 7. ADS 数据应用层

##### 7.1. ADS 定义

ADS（Application Data Service），数据应用层，通常是存放计算得出的数据结果值，统计报表直接从这一层获取数据，然后在 BI 进行展示。

##### 7.2. ADS 功能

- DWS 主要是提供给数据产品和数据分析使用的数据：
  - 一般会存放在ES、Redis、PostgreSql等系统中供线上系统使用；
  - 也可能存放在hive或者Druid中，供数据分析和数据挖掘使用，比如常用的数据报表就是存在这里的。


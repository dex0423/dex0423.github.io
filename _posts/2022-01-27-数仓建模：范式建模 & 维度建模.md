---
layout:     post
title:      数仓建模：范式建模 & 维度建模
subtitle:   
date:       2022-01-27
author:     dex0423
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 数仓
---


# 1.


# 2. 范式建模

##### 2.1. 三范式：

- 第一范式：
  - 保证数据的原子性，没有重复列，列不可再分，也没有重复行；
  - 数据规整成二维表；
  - 确保每一列表达同一含义；
    - 比如成绩中，分数和评价，要拆分成两列；
  - 去掉多值属性；
    - 比如：地址信息，拆分成省、市、区、详细地址；
  - 拆成多列；
    - 比如：一个人有多个电话号码，应拆分成电话_1、电话_2；
  - 去掉重复组，挪到新表里面；
    - 不好拆分的列，可以单独建表；
    - 比如：每个人都有多个电话，就可以单独建一个电话号码表，新表中每一行、写入一组人员ID+电话号码；
  - 确定主键；
    - 确保每一行都是唯一的；
    
- 第二范式：
  - 确保表中的每列都和主键相关；
  - 也就是说在一个数据库表中，一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中；
  - 如果不遵守第二范式：
    - 会比存在数据冗余；
    - 同时存在数据不一致的风险；
    - 另外，关系也会被隐藏在表中，不能很直观的展示出来；
  - 比如：下方学生成绩表中，学生姓名、学生课程，各自都只与主键学号有关，这是就应该拆分成两个表；
    ![]({{site.baseurl}}/img-post/数仓建模-数仓建模注意的问题-1.png)

- 第三范式：
  - 非主键属性只能依赖于主键，不能依赖于其他非主键属性；
  - 如果非主键属性、依赖于其他非主键属性，则需要移出去创建新表；
  - 比如：下方学生班级成绩表中，班级名称依赖于班级编号，而不是主键学号，这是就应该分拆成两个表；
    ![]({{site.baseurl}}/img-post/数仓建模-数仓建模注意的问题-2.png)

##### 2.2. BCNF

- BCNF 中，任何属性（包括主属性和非主属性），都不能被非主属性所决定；
- BCNF 必须规避下面的问题：
  - 存在联合主键；
  - 存在多个可选键；
    - 可选键存在重叠；
  - 比如：下表中，班级+课程、班级+教师，都可以作为联合主键，就可以拆分成两个表；
    ![]({{site.baseurl}}/img-post/数仓建模-数仓建模注意的问题-3.png)


##### 2.3. 第四范式

- 多值依赖；
  - 多值依赖：三个属性A、B、C在一起做联合主键，AB、AC都存在依赖关系，并且B和C之间没有依赖关系；
  - 第四范式就是要消除多值依赖；
- 比如：下表中，学号、课程、语言做联合主键，学号+课程、学号+语言，是相互依赖的，但是课程和语言没有依赖关系，这时候就要拆分成两个表；  
  ![]({{site.baseurl}}/img-post/数仓建模-数仓建模注意的问题-4.png)
- 第四范式下：
  - 数据冗余会减少；
  - 数据关系会更清晰；

##### 2.4. 第五范式

- 连接依赖：
  - 连接依赖：三个属性A、B、C在一起做联合主键，AB、AC、BC都存在依赖关系；
  - 第五范式就是要消除连接依赖；

![]({{site.baseurl}}/img-post/数仓建模-数仓建模注意的问题-5.png)

##### 范式建模关键点

- 第一范式必须严格遵守；
- 数据与数据的关系，用表关联的方式体现出来，而不是用数据内容来体现；
- 尽可能的减少冗余，同一含义的数据只存一分。
- 第四范式和第五范式，可以参考但实际不常用；

# 3. 维度建模

##### 3.1. 维度表

- 维度表，顾名思义就是一些维度信息，这种表数据，一般就直接存储维度信息，很多时候维度表都不会很大。
- 维度表，一定是被共享的、通用性的，在数仓系统内一项维度只会有一张维度表；
- 维度表，轻易不会做变更修改，可以增加、尤其是不要轻易做修改和删除操作；
- 维度表，会与事实表的维度列做外键关联，使事实表可以生成更多的维度信息；

- 维度表设计
  - 一般会把维度信息单独存放，其他表要使用时，记录对应维度的id即可。这样，就算维度表中数据发生了变化，其他表数据因为只是记录了id，不会有影响。
  - 维度信息放在一张表中存放，而不是每个表中存储一份，将来需要调整，只需要做一次工作即可，降低了数据冗余。


##### 3.2. 事实表

- 事实表，就是表述一些事实信息，如订单、收藏,添加购物车等信息，这种数据量较大；
- 事实表由维度和度量组成，事实表中存储的是维度信息（维度列）、以及可度量的值（属性列）；
  - 比如：区域销售表中，地区是维度，而销售额是度量；
- 事实表中一般会使用一个代号、或者整数（如：ID）来代表维度成员，而不是描述性的名称；
  - 比如：区域销售统计中，地区一般记录地区ID，而不是地区名称；
- 因为数据可能会变化，这种一般存储维度主键，具体维度值在后续处理分析时再临时关联；
- 事实表中的维度，一定会对应一张维度表；
  

##### 如果按照范式建模规范，维度建模会存在大量冗余，
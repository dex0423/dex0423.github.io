---
layout:     post
title:      Hive：Hive 安装部署示例
subtitle:   
date:       2022-01-28
author:     dex0423
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - Hive
---

# 1. 环境准备

- 由于 Apache Hive 是一款基于 Hadoop 的数据仓库软件，通常部署运行在 Linux 系统之上。因此不管使用何种方式配置 Hive Metastore，必须要先保证服务器的基础环境正常，Hadoop 集群健康可用。
- 服务器基础环境
    - 集群时间同步、防火墙关闭、主机Host映射、免密登录、JDK安装
- Hadoop 集群健康可用
    - 启动 Hive 之前必须先启动 Hadoop 集群。
    - 特别要注意，需等待 HDFS 安全模式关闭之后再启动运行 Hive。
    - Hive 不是分布式安装运行的软件，其分布式的特性主要借由 Hadoop 完成，包括分布式存储、分布式计算。

# 2. 安装 MySQL

#### 2.1. 删除 自带mariadb

```
[root@hadoop102 ~]# rpm -qa|grep mariadb
mariadb-libs-5.5.60-1.el7_5.x86_64
[root@hadoop102 ~]# rpm -e mariadb-libs-5.5.60-1.el7_5.x86_64 --nodeps
[root@hadoop102 ~]# rpm -qa|grep mariadb
[root@hadoop102 ~]# 
```

#### 2.2. 安装软件

- 上传文件安装包

- 解压缩
    ```
    tar xvf mysql-5.7.29-1.el7.x86_64.rpm-bundle.tar
    ```
    
    ```
    [root@hadoop102 mysql]# tar xvf mysql-5.7.29-1.el7.x86_64.rpm-bundle.tar 
    mysql-community-embedded-devel-5.7.29-1.el7.x86_64.rpm
    mysql-community-test-5.7.29-1.el7.x86_64.rpm
    mysql-community-embedded-5.7.29-1.el7.x86_64.rpm
    mysql-community-embedded-compat-5.7.29-1.el7.x86_64.rpm
    mysql-community-libs-5.7.29-1.el7.x86_64.rpm
    mysql-community-client-5.7.29-1.el7.x86_64.rpm
    mysql-community-server-5.7.29-1.el7.x86_64.rpm
    mysql-community-devel-5.7.29-1.el7.x86_64.rpm
    mysql-community-libs-compat-5.7.29-1.el7.x86_64.rpm
    mysql-community-common-5.7.29-1.el7.x86_64.rpm
    [root@hadoop102 mysql]# ls
    mysql-5.7.29-1.el7.x86_64.rpm-bundle.tar                 mysql-community-embedded-devel-5.7.29-1.el7.x86_64.rpm
    mysql-community-client-5.7.29-1.el7.x86_64.rpm           mysql-community-libs-5.7.29-1.el7.x86_64.rpm
    mysql-community-common-5.7.29-1.el7.x86_64.rpm           mysql-community-libs-compat-5.7.29-1.el7.x86_64.rpm
    mysql-community-devel-5.7.29-1.el7.x86_64.rpm            mysql-community-server-5.7.29-1.el7.x86_64.rpm
    mysql-community-embedded-5.7.29-1.el7.x86_64.rpm         mysql-community-test-5.7.29-1.el7.x86_64.rpm
    mysql-community-embedded-compat-5.7.29-1.el7.x86_64.rpm
    ```

- 安装依赖

    ```
    yum -y install libaio
    ```

    ```
    [root@hadoop102 mysql]# yum -y install libaio
    Loaded plugins: fastestmirror
    Determining fastest mirrors
    base                                                                                                                        | 3.6 kB  00:00:00     
    epel                                                                                                                        | 4.7 kB  00:00:00     
    extras                                                                                                                      | 2.9 kB  00:00:00     
    updates                                                                                                                     | 2.9 kB  00:00:00     
    (1/7): base/7/x86_64/group_gz                                                                                               | 153 kB  00:00:00     
    (2/7): epel/x86_64/group_gz                                                                                                 |  96 kB  00:00:00     
    (3/7): base/7/x86_64/primary_db                                                                                             | 6.1 MB  00:00:00     
    (4/7): epel/x86_64/updateinfo                                                                                               | 1.1 MB  00:00:00     
    (5/7): epel/x86_64/primary_db                                                                                               | 7.0 MB  00:00:00     
    (6/7): extras/7/x86_64/primary_db                                                                                           | 247 kB  00:00:00     
    (7/7): updates/7/x86_64/primary_db                                                                                          |  16 MB  00:00:00     
    Resolving Dependencies
    --> Running transaction check
    ---> Package libaio.x86_64 0:0.3.109-13.el7 will be installed
    --> Finished Dependency Resolution
    
    Dependencies Resolved
    
    ===================================================================================================================================================
     Package                          Arch                             Version                                    Repository                      Size
    ===================================================================================================================================================
    Installing:
     libaio                           x86_64                           0.3.109-13.el7                             base                            24 k
    
    Transaction Summary
    ===================================================================================================================================================
    Install  1 Package
    
    Total download size: 24 k
    Installed size: 38 k
    Downloading packages:
    libaio-0.3.109-13.el7.x86_64.rpm                                                                                            |  24 kB  00:00:00     
    Running transaction check
    Running transaction test
    Transaction test succeeded
    Running transaction
    ** Found 2 pre-existing rpmdb problem(s), 'yum check' output follows:
    2:postfix-2.10.1-6.el7.x86_64 has missing requires of libmysqlclient.so.18()(64bit)
    2:postfix-2.10.1-6.el7.x86_64 has missing requires of libmysqlclient.so.18(libmysqlclient_18)(64bit)
      Installing : libaio-0.3.109-13.el7.x86_64                                                                                                    1/1 
      Verifying  : libaio-0.3.109-13.el7.x86_64                                                                                                    1/1 
    
    Installed:
      libaio.x86_64 0:0.3.109-13.el7                                                                                                                   
    
    Complete!
    ```
- 安装 mysql

    ```
    rpm -ivh mysql-community-common-5.7.29-1.el7.x86_64.rpm mysql-community-libs-5.7.29-1.el7.x86_64.rpm mysql-community-client-5.7.29-1.el7.x86_64.rpm mysql-community-server-5.7.29-1.el7.x86_64.rpm
    ```

    ```
    [root@hadoop102 mysql]# rpm -ivh mysql-community-common-5.7.29-1.el7.x86_64.rpm mysql-community-libs-5.7.29-1.el7.x86_64.rpm mysql-community-client-5.7.29-1.el7.x86_64.rpm mysql-community-server-5.7.29-1.el7.x86_64.rpm
    warning: mysql-community-common-5.7.29-1.el7.x86_64.rpm: Header V3 DSA/SHA1 Signature, key ID 5072e1f5: NOKEY
    Preparing...                          ################################# [100%]
    Updating / installing...
       1:mysql-community-common-5.7.29-1.e################################# [ 25%]
       2:mysql-community-libs-5.7.29-1.el7################################# [ 50%]
       3:mysql-community-client-5.7.29-1.e################################# [ 75%]
       4:mysql-community-server-5.7.29-1.e################################# [100%]
    ```

# 初始化配置

- 初始化启动
    ```
    mysqld --initialize
    ```

- 更改所属组
    ```
    chown mysql:mysql /var/lib/mysql -R
    ```
  
- 启动 mysql
    ```
    systemctl start mysqld.service
    ```
      
- 查看生成的临时 root 密码

    ```
    cat  /var/log/mysqld.log
    ...
    [Note] A temporary password is generated for root@localhost: o+TU+KDOm004
    ```

- 修改root密码 授权远程访问 设置开机自启动

  ```shell
  [root@node2 ~]# mysql -u root -p
  Enter password:     #这里输入在日志中生成的临时密码
  Welcome to the MySQL monitor.  Commands end with ; or \g.
  Your MySQL connection id is 3
  Server version: 5.7.29
  
  Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.
  
  Oracle is a registered trademark of Oracle Corporation and/or its
  affiliates. Other names may be trademarks of their respective
  owners.
  
  Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
  
  mysql> 
  
  
  #更新root密码  设置为hadoop
  mysql> alter user user() identified by "hadoop";
  Query OK, 0 rows affected (0.00 sec)
  
  
  #授权
  mysql> use mysql;
  
  mysql> GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'hadoop' WITH GRANT OPTION;
  
  mysql> FLUSH PRIVILEGES; 
  
  #mysql的启动和关闭 状态查看 （这几个命令必须记住）
  systemctl stop mysqld
  systemctl status mysqld
  systemctl start mysqld
  
  #建议设置为开机自启动服务
  [root@node2 ~]# systemctl enable  mysqld                             
  Created symlink from /etc/systemd/system/multi-user.target.wants/mysqld.service to /usr/lib/systemd/system/mysqld.service.
  
  #查看是否已经设置自启动成功
  [root@node2 ~]# systemctl list-unit-files | grep mysqld
  mysqld.service                                enabled 
  ```



#### 
 修改Hadoop中core-site.xml，并且Hadoop集群同步配置文件，重启生效。
     因为Hive需要把数据存储在HDFS上，并且通过MapReduce作为执行引擎处理数据；
     因此需要在Hadoop中添加相关配置属性，以满足Hive在Hadoop上运行。

```
<!-- 整合hive --> 
<property> 
    <name>hadoop.proxyuser.root.hosts</name> 
    <value>*</value>
</property> 
<property> 
    <name>hadoop.proxyuser.root.groups</name> 
    <value>*</value>
</property>
```



#### 配置文件

```
#HIVE_HOME
export HIVE_HOME=/usr/local/apache-hive-3.1.2-bin
export PATH=$PATH:HIVE_HOME/bin
```

- 编辑 hive-site.xml

```
vim hive-site.xml
```


```
<configuration>
  <property>
     <!-- 查询数据时 显示出列的名字 -->
     <name>hive.cli.print.header</name>
     <value>true</value>
  </property>
  <property>
     <!-- 在命令行中显示当前所使用的数据库 -->
     <name>hive.cli.print.current.db</name>
     <value>true</value>
  </property>
  <property>
     <!-- 默认数据仓库存储的位置，该位置为HDFS上的路径 -->
     <name>hive.metastore.warehouse.dir</name>
     <value>/user/hive/warehouse</value>
  </property>
  <!-- 8.x -->
  <property>
     <name>javax.jdo.option.ConnectionURL</name>
     <value>jdbc:mysql://hadoop102:3306/hive?createDatabaseIfNotExist=true&amp;useSSL=false&amp;serverTimezone=GMT</value>
  </property>
  <!-- 8.x -->
  <property>
     <name>javax.jdo.option.ConnectionDriverName</name>
     <value>com.mysql.jdbc.Driver</value>
  </property>
  <property>
     <name>javax.jdo.option.ConnectionUserName</name>
     <value>root</value>
  </property>
  <property>
     <name>javax.jdo.option.ConnectionPassword</name>
     <value>123456</value>
  </property>
  <!-- hiveserver2服务的端口号以及绑定的主机名 -->
  <property>
     <name>hive.server2.thrift.port</name>   
     <value>10000</value>  
  </property>
  <property>
     <name>hive.server2.thrift.bind.host</name>
     <value>master</value>
  </property>
</configuration>

```

- core-site.xml
```
vim core-site.xml
```


```
<!--该参数表示可以通过httpfs接口hdfs的ip地址限制-->

<property>

    <name>hadoop.proxyuser.root.hosts</name>
    
    <value>*</value>

</property>

<!--通过httpfs接口访问的用户获得的群组身份-->

<property>

    <name>hadoop.proxyuser.root.groups</name>
    
    <value>*</value>

</property>

```


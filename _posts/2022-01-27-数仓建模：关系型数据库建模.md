---
layout:     post
title:      数仓建模：关系型数据库建模
subtitle:   
date:       2022-01-27
author:     dex0423
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 数仓
---


# 1. 实体 Entity

##### 1.1. 实体的定义

- 实体，是具体事物的抽象化描述，是数据库中存储的所有信息；
- 实体，对应数据库的表；
- 实体中的实例，指的就是一行行的数据。

>实体，通常指的是业务场景中【名词】，也指一个要处理的抽象的【对象】。

##### 1.2. 实体的分类

![]({{site.baseurl}}/img-post/数仓建模-关系型数据库建模-1.png)

# 2. 属性 Attribute

##### 2.1. 属性的定义

- 属性，对应的是表的列；
- 在关系型数据库中，属性通常都是单值的；
  - 如果存在多值，则需要另外建属性表；

##### 2.2. 属性的分类

- ID；
  - 标识实体的唯一性，一般是唯一主键；
- 描述；
- 引用；
  - 引用的其他实体的信息，比如订单表中会引入商品信息、客户信息，就需要加入商品ID、客户ID；
- 分类；
  - 实体所属的分类，比如客户分为国内客户、国外客户；
  - 注意：不同分类方法，会对应不同的属性值，需要注意对应关系和唯一性；
- 限制；
  - 比如：最低价格；
- 数量；
  - 比如：订单的采购数量、交易的金额等；
- 时间相关；
  - 日期型；
  - 时间戳性；
  - 时间型；
- 人物相关；
  - 比如：企业法人；
- 组织相关；
  - 比如：销售门店；
- 地点相关；
  - 比如：城市、国家、IP地址；
- 途径相关；
  - 比如：销售途径平台电商、自建独立站、直播间、代理商；
- 站点相关；
  - 比如：APP、web 站；
- 状态；
  - 比如：员工在职、离职；
- 审计；
  - 数仓中最常用的；
  - 创建、修改间戳；
    - 比如：add_time、update_time；
  - 操作人； 
    - 订单录入人、系统自动生成等；
  - 数据来源；
    - 数据的来源；
    - 比如：客户姓名、来自于客户信息系统，就要标注客户信息系统ID；
- 派生；
  - 预计算数据；
  - 数据内容的 MD5 校验码；
    - ETL 数据对账中经常使用；

##### 2.3. 属性的特性

- 强制 / 可选
  - 属性值是否可以为空；
- 原子 / 组合
  - 比如：姓、名都是原子的，二者在一起，组合构成姓名；
- 直接 / 派生
  - 比如：国家 + 省 + 城市 + 街道 + 门牌号 = 详细地址；
- 单值 / 多值
  - 关系型数据，不支持单实体、多属性，否则会违反 3NF，需要单独建子表；
- 可选键
  - 某一属性、或多个属性，可以作为判断唯一性的标识，即唯一键；
- 数据类型
  - INT、CHAR、DATE 等等；
- 默认值
  - 如果没有值，则赋与其默认值；
  - 比如：审计中的更新时间，为系统自动生成时间 current timestamp；
- 派生属性计算逻辑
  - 比如：手机号前缀（如+86） + 手机号 = 完整手机号；

# 3. 值域 Domain

##### 3.1. 值域的定义

- 值域，指的是属性所有取值范围的集合；
- 值域，可以理解为自定义的数据类型，同时可以加上约束条件；
- 值域范围，需要根据实际的业务场景决定取值范围；

##### 3.2. 值域的类型

- 格式：
  - varchar；
  - currency；
  - email；
    - 正则表达式匹配 @ 符：
  - 身份证号；
    - 位数限制、校验码；
  - 等等；
- 列表：
  - 枚举；
    - 比如：销售渠道包含淘宝店、京东店铺、抖音店铺，除此以外的值都是非法；
  - 月份；
    - 从 1月 到 12 月；
  - 性别；
    - Male、Female、Unknown；
  - 名称：
    - LongName：VARCHAR(255)，容纳公司名称、其他名称；
    - ShortName：VARCHAR(50)，容纳人名、部门名称；
  - 等等；
- 范围：
  - 年龄：0 ~ 100；
  - 角度：-180 ~ +180；


##### 3.3. 值域的作用

- 数据质量：
  - 值域范围规范，可以大幅提高数据质量；
- 易懂易用：
  - 数据模型会更加容易理解和使用；
- 数据标准化：
  - 提高模型质量和建模效率；

##### 3.4. 值域的应用

- PostgreSQL、Oracle；

>注意：MySQL，不支持值域！！！



---
layout:     post
title:      数仓工具：常见的 HDFS 故障及排除策略
subtitle:   
date:       2022-01-27
author:     dex0423
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 数仓
---



Hadoop宕机

（1）如果MR造成系统宕机。此时要控制Yarn同时运行的任务数，和每个任务申请的最大内存。调整参数：yarn.scheduler.maximum-allocation-mb（单个任务可申请的最多物理内存量，默认是8192MB）

（2）如果写入文件过量造成NameNode宕机。那么调高Kafka的存储大小，控制从Kafka到HDFS的写入速度。高峰期的时候用Kafka进行缓存，高峰期过去数据同步会自动跟上。

##### 报错：no YARN_RESOURCEMANAGER_USER defined

- 报错内容：
    `ERROR: but there is no YARN_RESOURCEMANAGER_USER defined. Aborting operation.`
- 解决办法：

  ```
  cd /usr/local/hadoop-3.1.3/sbin/
  ```

    ```
    vim start-dfs.sh
    
    # 在文件顶部添加以下参数
    HDFS_NAMENODE_USER=root
    HDFS_DATANODE_USER=root
    HDFS_SECONDARYNAMENODE_USER=root
    YARN_RESOURCEMANAGER_USER=root
    YARN_NODEMANAGER_USER=root
    ```
    
    ```
    vim stop-dfs.sh
    
    # 在文件顶部添加以下参数
    HDFS_NAMENODE_USER=root
    HDFS_DATANODE_USER=root
    HDFS_SECONDARYNAMENODE_USER=root
    YARN_RESOURCEMANAGER_USER=root
    YARN_NODEMANAGER_USER=root
    ```

    ```aidl
    vim start-yarn.sh
    
    # 在文件顶部添加以下参数
    YARN_RESOURCEMANAGER_USER=root
    HADOOP_SECURE_DN_USER=yarn
    YARN_NODEMANAGER_USER=root
    ```

    ```aidl
    vim stop-yarn.sh
    
    # 在文件顶部添加以下参数
    YARN_RESOURCEMANAGER_USER=root
    HADOOP_SECURE_DN_USER=yarn
    YARN_NODEMANAGER_USER=root
    ```

##### bash: jps: command not found

- 报错内容：
  ```aidl
    bash: jps: command not found
  ```

- 解决方法：
  - 删除原有的 jps 软连接，并新建一个
    ```aidl
    rm /usr/local/bin/jps
    ln -s /usr/local/bin/jdk1.8/bin/jps /usr/local/bin/jps
    ```
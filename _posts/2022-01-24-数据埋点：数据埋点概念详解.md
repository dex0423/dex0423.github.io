---
layout:     post
title:      数据埋点：数据埋点概念详解
subtitle:   
date:       2022-01-27
author:     dex0423
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 数据埋点
---


#### 埋点适用场景

- 抽象场景
  - 需要定期汇报考核 KPI
  - 需要周期性分析 KPI 增长情况
  - 需要对业务数据进行深度挖掘
  - 需要进行归因分析
  - 需要优化产品和运行策略
- 具体场景
  - 流量监控
    - 各功能模块使用情况分析
  - 活动效果评估
  - 用户行为日志
  - 用户画像
  - 漏斗分析
  - 留存分析
  - 活跃分析
  - 互动分析
  - 算法推荐（千人千面）
  - A/B 测试
  - 广告投放
  - 波动警报

#### OSM 模型

- Object
  - KPI，业务目标；
  - 如：
    - 拉新
    - 提升留存
    - 提高转化
    - 提升客单价
    - 降低客诉
- Strategy
  - 业务策略
- Measurement
  - 指标

#### 多维事件模型

- event，使用 event 记录用户在产品上的各种行为；
- user， 使用 user 记录用的基础属性信息
- 二者既可以分别分析，也可以关联分析。

#### 埋点的要求

- 数据稳定准确，反映真实业务场景
- 需要长期监控，数据需要长期存储
- 业务属性丰富，可以做深度业务分析
- 对于核心 KPI，指标需要全面覆盖
- 需要设置数据权限

#### 埋点设计原则

- 驼峰命名法；
- 命名格式：模块_页面_事件；
- 区分公共事件，
  - 如设备、位置、机型等，不要每次都上报，这样可以大大减少数据冗余；
- 相同的功能事件设置相同的 event_id，通过属性参数来做区分；

#### 埋点日志基本字段

- 用户 ID
- 事件名称
- 事件 ID
- 所在页面（位置）
- 属性
- 属性值
- 时间

#### 数据埋点工作流程

- 梳理埋点需求（分析指标体系）
- 制定埋点规则
  - 命名的规范化
  - 埋点流程统一化
- 制定埋点数据的清洗规则
  - 数据清洗规范化
- 维护埋点的测试、上线、下线
- 维护埋点元数据（埋点管理系统）

#### 埋点需求基本要素

- 上报时间
- 涉及页面
- 用户信息
- 系统信息
- 触发条件（session 回溯）
- 上报位置

#### 埋点方式

- 事件埋点
  - 比如：用户登录；
- 页面埋点
  - 页面打开、关闭
- 曝光埋点
  - 比如：广告（用于计算曝光数）
  - 有效曝光 / 逻辑可见：
    - 停留时间大于 2 秒；
  - 曝光逻辑：
    - 一个模块只曝光一次、且上报一次（如果已经上报，就不做二次上报）；
    - 标题曝光，即视为模块模块曝光；
- 上报时机：
  - 进入页面时，模块可见面积大于 50%，才上报；
  - 手指不停的滑动，模块可见面积小于 50% 不上报，大于 50% 才上报；
  - 滑动停止时，模块可见面积小于 50% 不上报，大于 50% 才上报；



#### 前端埋点 & 后端埋点

- 前端埋点为主，后端埋点为辅；
- 后端数据作为标准，前端数据作为参考；
- 很多时候，需要相互配合；
  - 比如：
    - 判定用户登录是否成功，需要后端判定登录状态，结合前端的登录行为才能判定；
    - 获取用户的支付信息，前端只展示标出来的价格，但实际支付的时候可能会有优惠，需要结合后端的支付数据才能确定实际价格；

 
#### 埋点策略

- 代码埋点
  - 指令式埋点：
    - 用户在埋点位置触发事件，由预先定义的函数上报事件相关数据。
    - 优点：
    - 缺点：
      - 和业务耦合度比较高，每增加需求都要做版本更新迭代；
      - 代码开发的工作量比较大；
      - 开发成本较高。
  - 声明式埋点：
    - 预先声明埋点类型（提前封装好自定义的指令），在 DOM 或者组件上，通过设置即可以完成事件的统一上报；
    - 优点：
      - 埋点和业务代码实现了解耦；
      - VUE 比较流行的埋点方式。
- 全埋点
  - 全部免采集用户的行为；
  - 优点：
    - 数据全部采集，不会有遗漏；
  - 缺点：
    - 后端日志服务器亚历山大；
    - 占用网络资源，对用户浏览体验也会有影响；
- 可视化埋点
  - 通过可视化的自定义埋点；
  - 优点：
    - 操作简单；
    - 支持自定义属性；
    - 适用于非技术人员进行埋点工作；
  - 缺点：
    - 覆盖的功能有限，不支持后端埋点；
    - 开发难度大，需要在 web 短提前解析 DOM，并将解析后的 DOM 进行可视化，并能实现准确的自定义配置，对开发要求比较高。
- 第三方 SDK 埋点
  - 神策
  - 诸葛
  - Growing IO
  - 只需要集成 SDK 就可以实现埋点；
  - 基本都提供私有化部署，不用担心数据安全问题。

#### 第三方工具存在的问题

- 非实时反馈
- 数据波动难以定位
- 与第三方沟通成本太高
- 没有自己的核心数据存储

- 电商时间埋点方案示例

  ![]({{site.baseurl}}/img-post/指标体系方法论-5.png)

#### 埋点要注意的问题

- 上报机制
    - APP
        - 延时上报，将数据预先存储在手机上，等到有 WIFI 环境时再上报；
- 数据误差
    - 一般情况下，误差率小于 5% ；
- 埋点数据处理流程
- 埋点误区
- APP端埋点
- 小程序埋点
- H5 埋点

#### 埋点项目示例

![]({{site.baseurl}}/img-post/指标体系方法论-4.png)

#### 埋点测试

[//]: # (#### 埋点数据校验)

- 是否被正常触发
- 触发时机是否正确
- 报送内容是否准确、完整

#### 埋点校验方式

- 前端校验
  - debugger 断点
- 后端校验
  - 数据库验证

#### 系统化管理埋点

- 实现统一的格式；
- 方便埋点查询、变更管理；
- 易于埋点元数据管理；
- 方便埋点生命周期管理；
- 便于进行埋点数据质量的监控。
---
layout:     post
title:      数据治理：元数据管理
subtitle:   
date:       2022-01-27
author:     dex0423
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 数仓
---

# 1. 元数据概念

##### 1.1. 元数据定义

- 元数据（Metadata），又称中介数据、中继数据，为描述数据的数据（data about data），主要是描述数据属性（property）的信息，用来支持如指示存储位置、历史数据、资源查找、文件记录等功能。
- 元数据算是一种电子式目录，为了达到编制目录的目的，必须在描述并收藏数据的内容或特色，进而达成协助数据检索的目的。
- 对于 RMDB 库来说，元数据（字典）是属于数据库本身的一些数据，包含数据库名、数据库字符集、表名、表的大小、表的记录行数、表的字符集、表的字段、表的索引、表的描述、字段的类型、字段的精度、字段的描述等。对于来自 information_schema 的数据库内部数据，如表的大小、表的行数可能不是非常精准，仅做数量级的参考。
>注意：业务数据才会有元数据这个概念，系统日志、备份数据是没有元数据这个概念的。


##### 1.2. 元数据管理

- 元数据管理，是为了对数据资产进行有效的组织。它使用元数据来帮助管理他们的数据。它还可以帮助数据专业人员收集、组织、访问和丰富元数据，以支持数据治理。



##### 1.3. 元数据管理的价值

- 元数据管理，最重要的意义就是数据资源的可管、可控、可查。
- 元数据管理，可以方便的进行数据调研成果的落地、共享，支撑数仓螺旋开发。这是团队协作的要求，也是项目经验的知识沉淀。
- 支撑各类数据报表、运营统计，为后续数据处理提供基础元数据查询。
  - 比如：统计接入了多少个系统、每个系统有多少张表，数据清洗需要知道每张表的字段信息。
- 元数据还可以通过 OpenAPI 实现导出，快速支持保障合规审计等工作。


##### 1.4. 元数据的种类

- 技术元数据
- 业务元数据
- 操作元数据
- 管理元数据

![]({{site.baseurl}}/img-post/元数据-1.png)

# 2. 元数据架构

##### 2.1. 集中式的架构

- 指的是采集多种数据源的元数据到元数据自己的存储中来，再集中加工给其他场景提供服务；

##### 2.2. 分散式的架构

- 没有自己的元数据存储，而是在使用的时候，去即时的查询其他数据源的元数据。

##### 2.3. 集中式的架构 VS 分散式的架构

- 集中式的架构
  - 优点：可以快速的检索元数据，抽取的时候，也可以自由的转换，自定义补充，提升了元数据的质量；
  - 缺点：需要保证自身存储和其他源数据的一致性，增加了流程复杂度和工作量。

- 分散式架构
  - 优点：元数据总能够保持最新，查询更加的简单；
  - 缺点：无法自定义或修改元数据项，查询也受源系统可用性的影响。

>一般我们推荐使用集中式架构，定时采集源系统的元数据，通过 hook 方式捕捉各种引擎运行时数据血缘关系，并且定义通用的数据模型提供给第三方接入使用。

##### 2.4. Hook 方式采集数据血缘

当前众多大数据组件都提供了 Hook 钩子的方式，相当于以插件的方式实时的捕捉执行计划。解析之后，推送到 Kafka，再去解析到分布式的图数据库中。

##### 2.5. 通用的数据源模块

一般公司肯定是存在多种不同类型的数据源的，比如 Mysql，Oracle，Hive 等，可以制作一个通用的模块，提供统一的接口，来对接这些不同的数据源。

数据源模块则提供三方接口供采集模块定时采集数据源的元数据信息。

核心的技术点，就是要隔离不同数据源的驱动，这些驱动也需要以插件化来集成到数据源模块中。

##### 2.6. 个性化的 SDK 接入

如果公司的核心业务部门比较多，公司的数据平台产品比较多，那么势必会产生一些其他的元数据。比如监控平台监控的资源使用情况、任务调度的任务运行情况等。

这种 SDK 接入，需要考虑接入时的安全校验，限流（可定时消费一批Kafka数据来实现）等问题。

##### 2.7. 后端存储的统一模型

元数据类型纷繁杂乱，需要统一整理抽象，再分类存储，并且设计之初，就要尽可能的详尽所有情况，设计出统一的表模型，预留扩展字段。

有一套模型是专门解决元数据模型通用性问题的，叫做 CWM （Common Warehouse Metamodel）标准，翻译过来是公共仓库元模型，这里提供了三层元模型来存储一切不同类型的元数据，当然设计起来比较复杂，一般超大型企业会采用这种模型。

如果可以详尽公司未来的元数据种类，可以分门别类建不同类型的元数据模型表来解决。

参考有赞这样的大公司，元数据可分为：

基础元数据表；
趋势数据表；
任务元数据表；
血缘数据表

# 3. 技术元数据

##### 2.1. 数据结构

- 库
    - 名称
    - 字符集

- 表
    - 名称
    - 描述
    - 字符集
    - 行数
    - 容量

- 字段
    - 名字
    - 类型
    - 是否可空
    - 长度
    - 精度
    - 描述

- 索引
    - 名字
    - 类型
    - 索引字段

- Key
    - primary key
    - unique key
    
- 可编程对象
    - 名称
    - 类型

- SQL_MODE
    - SQL_MODE 更多信息，可以参考文章 《 <a href="http://blog.itpub.net/26736162/viewspace-2149027/">MySQL SQL Mode（模式）介绍</a> 》。


##### 2.2. 数据部署
- 数据集的物理位置；

##### 2.3. 存储过程
- SQL 语句集

##### 2.4. 数据依赖
- 数据流向，ETL规则，数据集之间的依赖关系；

##### 2.5. 质量度量
- 数据集上可以计算的度量；

##### 2.6. 度量逻辑关系
- 数据集度量之间的逻辑关系；

##### 2.7. ETL 过程
- ETL 顺序、并行&串行；

##### 2.8. 数据集快照
- 某一时间点上，数据在所有数据集上的分布情况；

##### 2.9. 数据模型元数据
- 事实表、维度、属性、层次；

##### 2.10. 报表语义
- 报表的指标体系、规则、过滤条件；
- 物理名称 & 业务名称对应关系；

##### 2.11. 数据访问日志
- 数据被用户访问的情况；

##### 2.12. 质量稽核日志
- 何时、哪个度量被稽核；

##### 2.13. 数据装载日志
- 那些数据、何时、被谁装载；

# 4. 业务元数据

##### 4.1. 业务域

- 数据库表的业务域
- 所在的项目
- 所在的集群

##### 4.2. 业务规则

- 转换规则 
- 计算公式
- 推导公式等（更多是文档）；

##### 4.3. 数据模型；

##### 4.4. 数据质量规则和核检结果

##### 4.5. 数据标准；

##### 4.6. 数据的安全，隐私级别；

##### 4.7. 数据使用说明等

# 5. 操作元数据

1、批处理的执行日志；

2、调度异常记录及处理；

3、报表和查询的访问模式，访问频率和执行时间；

4、数据产生；

5、表的访问（查询，关联，聚合等）；

6、字段的访问；

7、物理表的创建时间，创建人，更新时间，更新人

# 6. 管理元数据

1、人员

2、流程

3、职责、岗位

4、组织、部门；

# 7. 元数据项目步骤

##### 7.1. 划定元数据范围

首先确定元数据来源范围，在实际的工作中，不是所有数据都是要做元数据管理，通常我们会选择业务数据做元数据管理，非业务数据（例如：备份数据、系统日志等）是不会纳入管理范围内，主要还是因为元数据管理是提供业务和开发人员快速掌握业务数据。

确定规则后，就要结合公司的实际情况去梳理出哪些业务系统、哪些数据库、哪些数据库用户、哪些表需要做元数据管理。当然也可以支持非结构化数据的元数据抽取，例如：word、pdf等。

##### 7.2. 元数据标准

在梳理的过程中可能会出现有些数据库或者有些数据定义不规范的情况，导致元数据管理无法进行下去。那接下来需要建立元数据的管理规范，去反推前端的源数据进行整改，主要是保证元数据的完整性和一致性。

针对不同的类型的公司要求，元数据会开放给不同的人群，所以要对元数据进行权限管理，规范里面就需定义权限的管理流程：元数据的权限分层、元数据权限申请流程、元数据的发布流程、元数据的审核流程。

我的公司将元数据分为业务和技术两个管理属性，技术人员可以查看全域元数据，业务人员只能查看自己所对应业务流程的元数据，如要查看其他业务流程的元数据，需进行申请，申请流程要过元数据对应的业务和技术属主。


##### 7.3. 元数据接入

元数据从哪接入，一般都是从源系统接入，假如公司已经存在数仓或者实时性要求不高，为了节约开发工作量，对于已有的元数据会从数仓接入，还未接入的会从源系统进行接入。

但这种方案也是存在风险，假如数仓的数据和源系统出现不一致，就会导致元数据出错。现在大部分的元数据抽取都是采用配置自动化的方式进行。


##### 7.4. 元数据维护

元数据维护主要是对已经发布的元数据进行维护管理，已经发布上线的元数据，如需调整、优化则必须重新走元数据发布流程，不准许对元数据进行直接修改。为了安全，元数据所有操作行为都要记录到元数据操作日志里面。

可以对元数据创建目录将不同的元数据挂在对应的目录下，按照业务流程、业务主题域、开发流程设计对应的目录，主要还是根据公司要求设计。

##### 7.5. 元数据查找、分析、报告

有单独的页面支持元数据的模糊或精准快速查找，通过输入关键信息查找对应的元数据。我所在的公司将元数据作为数据资产的一类，因此我们需要产出元数据资产报告，从报告中能够快速的了解元数据访问热度、数据价值、数据成本、数据分布等相关信息。

分析这块上一篇文章就有提到，主要是血缘分析，做血缘分析的两种方法。血缘分析对做关联影响分析很重要，尤其是刚进来的开发或者业务不了解数据，通过血缘分析能够快速的定位、分析数据。
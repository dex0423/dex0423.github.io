---
layout:     post
title:      数仓建模：数仓建模要注意的问题
subtitle:   
date:       2022-01-27
author:     dex0423
header-img: img/post-bg-os-metro.jpg
catalog: true
tags:
    - 数仓
---


# 1. Null 值的使用

##### 1.1. Null 的定义

- NULL 不代表 0，也不代表 0 长度的字符串；

> NULL 的长度不是 0 ！

- 真未知；
- 尚未知；
- 不适用；

##### 1.2. Null 存在的隐患

- 数学计算
  - 任何值和 Null 计算，结果都是 Null；
  - 1 + Null = Null；
  - 1 / Null = Null；
- WEHRE 子句
  - 使用 <>、全选时，Null 值所在的这条记录，会被忽视掉；
- Join
  - Null 和 Null 做 Join 操作的时候，是不会有结果的； 
- 聚合函数
  - Null 在计算的时候，没有参与聚合计算；
  - 若 Null 重设为 0，则 AVG、MIN、MAX、COUNT 都会受到影响；
- 子查询
  - 使用 NOT IN 的时候，会出现错误；
  - 使用 NOT EXISTS，才能保证正常结果；

##### 1.3. 使用 Null 值的原则

- 同一个数据库，对于 Null 值的处理应有统一的原则；
- 数据质量要求不高的，默认值可以为 Null，然后对特殊字段特殊处理；
- 数据质量要求较高的，默认值均为 Not Null，然后特殊字段特殊处理；

![]({{site.baseurl}}/img-post/数仓建模-关系型数据库建模-2.png)

##### 1.4. 范式建模 Null 值使用原则

- 主数据表：
  - CODE 为主键，不可以为空；
    - 未知的值，可以按以下方式赋值：
      - 未知；
      - 不适用；
      - 非法；
      - 未分类；
  - NAME 不可以为空；
    - 默认值可设为空字符串 ''；
- Xref 表：
  - 多字段构成联合主键，不可以为空； 
    - 主要关心的的是多对多关系；
- 事务表：
  - 引用主数据表的字段、设为主键，不可以为空；
  - 为防止聚合计算时出现错误，应充分考虑 Null 值的处理方式，比如增加特殊字段；

# 2. 



# 2. 模型灵活性

##### 2.1. 表更新的复杂性

多系统合并、需要多个自然键组合做主键时，尽量不要使用复合键，可以使用 Checksum key，即对多系统的自然键进行 MD5 计算，用 MD5 结果值作为单键主键；

##### 2.2. SQL 语句复杂性

- 当 SQL 需要多表关联的时候，SQL 复杂性会迅速增加。

# 3. 空间占用

- 自然键：
  - 维度表，需要空间比较少；
  - 事实表，通常需要更多空间；
  - 整体来说，需要更多空间；
- 代理键：
  - 维度表，需要更多空间；
  - 事实表，需要更少空间；
  - 整体来说，需要更少空间；

# 4. SQL 语句资源消耗

- 代理键为整型，查询性能较好；
- 自然键如是 VARCHAR，性能比较差；

- 单键的性能较好；
- 复合键的性能差；

- 当数据量达到百万级的时候，性能差异会凸显；

# 5. 数据加载速度

- 自然键：
  - 维度表，直接从源系统过数据，额外开销比较少；
- 代理键：
  - 维度表，代理键插入必须计算最新插入的代理键，需要时间，但和自然键差别不大；

